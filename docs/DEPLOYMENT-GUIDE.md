# ğŸš€ ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã‚¬ã‚¤ãƒ‰

Promptyã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æœ¬ç•ªç’°å¢ƒã«ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ãŸã‚ã®å®Œå…¨ã‚¬ã‚¤ãƒ‰ã§ã™ã€‚è¤‡æ•°ã®ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã«å¯¾å¿œã—ã€åˆå¿ƒè€…ã§ã‚‚å®‰å…¨ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã§ãã‚‹ã‚ˆã†è©³ã—ãèª¬æ˜ã—ã¾ã™ã€‚

## ğŸ“‘ ç›®æ¬¡

1. [ğŸ¯ ãƒ‡ãƒ—ãƒ­ã‚¤æˆ¦ç•¥](#-ãƒ‡ãƒ—ãƒ­ã‚¤æˆ¦ç•¥)
2. [ğŸ”§ äº‹å‰æº–å‚™](#-äº‹å‰æº–å‚™)
3. [â˜ï¸ Vercel ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆæ¨å¥¨ï¼‰](#-vercel-ãƒ‡ãƒ—ãƒ­ã‚¤æ¨å¥¨)
4. [ğŸŒ Netlify ãƒ‡ãƒ—ãƒ­ã‚¤](#-netlify-ãƒ‡ãƒ—ãƒ­ã‚¤)
5. [ğŸ³ Docker ãƒ‡ãƒ—ãƒ­ã‚¤](#-docker-ãƒ‡ãƒ—ãƒ­ã‚¤)
6. [ğŸ–¥ï¸ VPS/å°‚ç”¨ã‚µãƒ¼ãƒãƒ¼ ãƒ‡ãƒ—ãƒ­ã‚¤](#-vpså°‚ç”¨ã‚µãƒ¼ãƒãƒ¼-ãƒ‡ãƒ—ãƒ­ã‚¤)
7. [â˜ï¸ AWS ãƒ‡ãƒ—ãƒ­ã‚¤](#-aws-ãƒ‡ãƒ—ãƒ­ã‚¤)
8. [ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®š](#-ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®š)
9. [ğŸ“Š ç›£è¦–ãƒ»ãƒ­ã‚°è¨­å®š](#-ç›£è¦–ãƒ­ã‚°è¨­å®š)
10. [ğŸ”„ CI/CD è¨­å®š](#-cicd-è¨­å®š)
11. [ğŸ“ˆ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–](#-ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–)
12. [â“ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°](#-ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°)

---

## ğŸ¯ ãƒ‡ãƒ—ãƒ­ã‚¤æˆ¦ç•¥

### ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ æ¯”è¼ƒ

| ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ  | é›£æ˜“åº¦ | ã‚³ã‚¹ãƒˆ | æ¨å¥¨ç”¨é€” |
|----------------|--------|--------|----------|
| **Vercel** | â­ ç°¡å˜ | ç„¡æ–™ã€œ | å€‹äººãƒ»å°è¦æ¨¡ |
| **Netlify** | â­â­ ç°¡å˜ | ç„¡æ–™ã€œ | é™çš„ã‚µã‚¤ãƒˆä¸­å¿ƒ |
| **Docker** | â­â­â­ ä¸­ç´š | ã‚¤ãƒ³ãƒ•ãƒ©ä¾å­˜ | æ±ç”¨æ€§é‡è¦– |
| **VPS** | â­â­â­â­ ä¸Šç´š | $5ã€œ/æœˆ | å®Œå…¨åˆ¶å¾¡ |
| **AWS** | â­â­â­â­â­ å°‚é–€ | å¾“é‡èª²é‡‘ | ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚º |

### æ¨å¥¨ãƒ•ãƒ­ãƒ¼
```
é–‹ç™ºç’°å¢ƒ â†’ ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒ â†’ æœ¬ç•ªç’°å¢ƒ
     â†“           â†“            â†“
  localhost   Vercel Preview  Vercel Production
```

---

## ğŸ”§ äº‹å‰æº–å‚™

### 1. ç’°å¢ƒå¤‰æ•°ã®æ•´ç†

æœ¬ç•ªç’°å¢ƒç”¨ã®ç’°å¢ƒå¤‰æ•°ã‚’æº–å‚™ï¼š

```bash
# .env.production (ã‚µãƒ³ãƒ—ãƒ«)
# ========================================
# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ (Supabase)
# ========================================
NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGci...
SUPABASE_SERVICE_ROLE_KEY=eyJhbGci...

# ========================================
# AI API (Claude)
# ========================================
CLAUDE_API_KEY=sk-ant-api03...

# ========================================
# æ±ºæ¸ˆ (Stripe)
# ========================================
STRIPE_SECRET_KEY=sk_live_...  # æœ¬ç•ªã‚­ãƒ¼ï¼
STRIPE_WEBHOOK_SECRET=whsec_...
NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY=pk_live_...  # æœ¬ç•ªã‚­ãƒ¼ï¼

# ========================================
# ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
# ========================================
CSRF_SECRET=your-256-bit-secret
ADMIN_API_KEY=your-admin-key
JWT_SECRET=your-jwt-secret
NEXTAUTH_SECRET=your-nextauth-secret

# ========================================
# æœ¬ç•ªç’°å¢ƒè¨­å®š
# ========================================
NODE_ENV=production
NEXT_PUBLIC_APP_URL=https://your-domain.com
```

### 2. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

ãƒ‡ãƒ—ãƒ­ã‚¤å‰ã«å¿…ãšç¢ºèªï¼š

- [ ] æœ¬ç•ªç”¨ã®APIã‚­ãƒ¼ã«å¤‰æ›´æ¸ˆã¿
- [ ] ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ãŒç„¡åŠ¹åŒ–ã•ã‚Œã¦ã„ã‚‹
- [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹
- [ ] HTTPS ãŒæœ‰åŠ¹åŒ–ã•ã‚Œã¦ã„ã‚‹
- [ ] ç’°å¢ƒå¤‰æ•°ãŒé©åˆ‡ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹
- [ ] ä¸è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ãŒé™¤å¤–ã•ã‚Œã¦ã„ã‚‹

### 3. ãƒ“ãƒ«ãƒ‰ãƒ†ã‚¹ãƒˆ

```bash
# æœ¬ç•ªãƒ“ãƒ«ãƒ‰ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã§ãƒ†ã‚¹ãƒˆ
npm run build

# ãƒ“ãƒ«ãƒ‰æˆæœç‰©ã®ç¢ºèª
npm start

# ã‚¨ãƒ©ãƒ¼ãŒãªã„ã“ã¨ã‚’ç¢ºèª
```

---

## â˜ï¸ Vercel ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆæ¨å¥¨ï¼‰

Vercelã¯ Next.js ã«æœ€é©åŒ–ã•ã‚Œã¦ãŠã‚Šã€æœ€ã‚‚ç°¡å˜ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã§ãã¾ã™ã€‚

### Step 1: GitHubãƒªãƒã‚¸ãƒˆãƒªæº–å‚™

```bash
# 1. GitHubã«ãƒªãƒã‚¸ãƒˆãƒªä½œæˆ
# https://github.com/new

# 2. ãƒ­ãƒ¼ã‚«ãƒ«ã‚³ãƒ¼ãƒ‰ã‚’ãƒ—ãƒƒã‚·ãƒ¥
git add .
git commit -m "Initial commit for production"
git remote add origin https://github.com/username/prompty.git
git push -u origin main
```

### Step 2: Vercelã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¨­å®š

```
1. https://vercel.com ã«ã‚¢ã‚¯ã‚»ã‚¹
2. GitHubã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—
3. ã€ŒContinue with GitHubã€ã‚’ã‚¯ãƒªãƒƒã‚¯
```

### Step 3: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚¤ãƒ³ãƒãƒ¼ãƒˆ

```
1. Vercelãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ã€ŒAdd New...ã€â†’ã€ŒProjectã€
2. GitHubãƒªãƒã‚¸ãƒˆãƒªã‚’é¸æŠ
3. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®š:
   - Project Name: prompty
   - Framework Preset: Next.js
   - Root Directory: ./
```

### Step 4: ç’°å¢ƒå¤‰æ•°è¨­å®š

```
1. Project Settings â†’ Environment Variables
2. ä»¥ä¸‹ã‚’ã™ã¹ã¦è¿½åŠ :
```

| Name | Value | Environment |
|------|-------|-------------|
| `NEXT_PUBLIC_SUPABASE_URL` | `https://xxx.supabase.co` | Production, Preview, Development |
| `NEXT_PUBLIC_SUPABASE_ANON_KEY` | `eyJhbGci...` | Production, Preview, Development |
| `SUPABASE_SERVICE_ROLE_KEY` | `eyJhbGci...` | Production, Preview, Development |
| `CLAUDE_API_KEY` | `sk-ant-api03...` | Production, Preview, Development |
| `STRIPE_SECRET_KEY` | `sk_live_...` | Production, Preview |
| `STRIPE_WEBHOOK_SECRET` | `whsec_...` | Production, Preview |
| `NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY` | `pk_live_...` | Production, Preview |
| `CSRF_SECRET` | `your-256-bit-secret` | Production, Preview, Development |
| `ADMIN_API_KEY` | `your-admin-key` | Production, Preview, Development |

### Step 5: ã‚«ã‚¹ã‚¿ãƒ ãƒ‰ãƒ¡ã‚¤ãƒ³è¨­å®š

```
1. Project Settings â†’ Domains
2. ã€ŒAddã€ã‚’ã‚¯ãƒªãƒƒã‚¯
3. ãƒ‰ãƒ¡ã‚¤ãƒ³åã‚’å…¥åŠ›: your-domain.com
4. DNSè¨­å®š:
   - Type: CNAME
   - Name: @
   - Value: cname.vercel-dns.com
```

### Step 6: ãƒ‡ãƒ—ãƒ­ã‚¤å®Ÿè¡Œ

```
1. ã€ŒDeployã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
2. ãƒ“ãƒ«ãƒ‰ãƒ­ã‚°ã‚’ç¢ºèª
3. å®Œäº†å¾Œã€ç”Ÿæˆã•ã‚ŒãŸURLã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦å‹•ä½œç¢ºèª
```

### Vercelè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆvercel.jsonï¼‰

```json
{
  "version": 2,
  "builds": [
    {
      "src": "package.json",
      "use": "@vercel/next"
    }
  ],
  "routes": [
    {
      "src": "/api/(.*)",
      "dest": "/api/$1"
    },
    {
      "src": "/(.*)",
      "dest": "/$1"
    }
  ],
  "functions": {
    "src/pages/api/**/*.ts": {
      "maxDuration": 30
    }
  },
  "headers": [
    {
      "source": "/(.*)",
      "headers": [
        {
          "key": "X-Frame-Options",
          "value": "DENY"
        },
        {
          "key": "X-Content-Type-Options",
          "value": "nosniff"
        }
      ]
    }
  ]
}
```

---

## ğŸŒ Netlify ãƒ‡ãƒ—ãƒ­ã‚¤

### Step 1: ãƒ“ãƒ«ãƒ‰è¨­å®š

```toml
# netlify.toml
[build]
  command = "npm run build && npm run export"
  publish = "out"

[build.environment]
  NODE_VERSION = "18"

[[headers]]
  for = "/*"
  [headers.values]
    X-Frame-Options = "DENY"
    X-XSS-Protection = "1; mode=block"
    X-Content-Type-Options = "nosniff"

[[redirects]]
  from = "/api/*"
  to = "/.netlify/functions/:splat"
  status = 200
```

### Step 2: Next.jsè¨­å®šèª¿æ•´

```javascript
// next.config.js (Netlifyç”¨)
/** @type {import('next').NextConfig} */
const nextConfig = {
  experimental: {
    appDir: true,
  },
  trailingSlash: true,
  output: 'export',
  images: {
    unoptimized: true
  }
}

module.exports = nextConfig
```

### Step 3: ãƒ‡ãƒ—ãƒ­ã‚¤å®Ÿè¡Œ

```bash
# 1. Netlify CLIã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm install -g netlify-cli

# 2. ãƒ­ã‚°ã‚¤ãƒ³
netlify login

# 3. åˆå›ãƒ‡ãƒ—ãƒ­ã‚¤
netlify deploy --prod --dir=out
```

---

## ğŸ³ Docker ãƒ‡ãƒ—ãƒ­ã‚¤

ã‚³ãƒ³ãƒ†ãƒŠåŒ–ã«ã‚ˆã‚Šãƒãƒ¼ã‚¿ãƒ–ãƒ«ãªãƒ‡ãƒ—ãƒ­ã‚¤ãŒå¯èƒ½ã§ã™ã€‚

### Dockerfile

```dockerfile
# Dockerfile
FROM node:18-alpine AS base

# Install dependencies only when needed
FROM base AS deps
RUN apk add --no-cache libc6-compat
WORKDIR /app

# Install dependencies based on the preferred package manager
COPY package.json yarn.lock* package-lock.json* pnpm-lock.yaml* ./
RUN \
  if [ -f yarn.lock ]; then yarn --frozen-lockfile; \
  elif [ -f package-lock.json ]; then npm ci; \
  elif [ -f pnpm-lock.yaml ]; then yarn global add pnpm && pnpm i --frozen-lockfile; \
  else echo "Lockfile not found." && exit 1; \
  fi

# Rebuild the source code only when needed
FROM base AS builder
WORKDIR /app
COPY --from=deps /app/node_modules ./node_modules
COPY . .

# Next.js collects completely anonymous telemetry data about general usage.
ENV NEXT_TELEMETRY_DISABLED 1

RUN npm run build

# Production image, copy all the files and run next
FROM base AS runner
WORKDIR /app

ENV NODE_ENV production
ENV NEXT_TELEMETRY_DISABLED 1

RUN addgroup --system --gid 1001 nodejs
RUN adduser --system --uid 1001 nextjs

COPY --from=builder /app/public ./public

# Set the correct permission for prerender cache
RUN mkdir .next
RUN chown nextjs:nodejs .next

# Automatically leverage output traces to reduce image size
COPY --from=builder --chown=nextjs:nodejs /app/.next/standalone ./
COPY --from=builder --chown=nextjs:nodejs /app/.next/static ./.next/static

USER nextjs

EXPOSE 3000

ENV PORT 3000
ENV HOSTNAME "0.0.0.0"

CMD ["node", "server.js"]
```

### docker-compose.yml

```yaml
version: '3.8'

services:
  prompty:
    build: .
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
      - NEXT_PUBLIC_SUPABASE_URL=${NEXT_PUBLIC_SUPABASE_URL}
      - NEXT_PUBLIC_SUPABASE_ANON_KEY=${NEXT_PUBLIC_SUPABASE_ANON_KEY}
      - SUPABASE_SERVICE_ROLE_KEY=${SUPABASE_SERVICE_ROLE_KEY}
      - CLAUDE_API_KEY=${CLAUDE_API_KEY}
      - STRIPE_SECRET_KEY=${STRIPE_SECRET_KEY}
      - STRIPE_WEBHOOK_SECRET=${STRIPE_WEBHOOK_SECRET}
      - NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY=${NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY}
      - CSRF_SECRET=${CSRF_SECRET}
      - ADMIN_API_KEY=${ADMIN_API_KEY}
    restart: unless-stopped
    
  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
      - ./ssl:/etc/nginx/ssl
    depends_on:
      - prompty
    restart: unless-stopped
```

### å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰

```bash
# ãƒ“ãƒ«ãƒ‰
docker-compose build

# èµ·å‹•
docker-compose up -d

# ãƒ­ã‚°ç¢ºèª
docker-compose logs -f prompty

# åœæ­¢
docker-compose down
```

---

## ğŸ–¥ï¸ VPS/å°‚ç”¨ã‚µãƒ¼ãƒãƒ¼ ãƒ‡ãƒ—ãƒ­ã‚¤

### ã‚µãƒ¼ãƒãƒ¼æº–å‚™ï¼ˆUbuntu 22.04ï¼‰

```bash
# 1. ã‚·ã‚¹ãƒ†ãƒ æ›´æ–°
sudo apt update && sudo apt upgrade -y

# 2. Node.js ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install -y nodejs

# 3. Nginx ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
sudo apt install nginx -y

# 4. PM2 ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆãƒ—ãƒ­ã‚»ã‚¹ç®¡ç†ï¼‰
sudo npm install -g pm2

# 5. Git ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
sudo apt install git -y

# 6. è¨¼æ˜æ›¸ç®¡ç†ï¼ˆLet's Encryptï¼‰
sudo apt install certbot python3-certbot-nginx -y
```

### ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‡ãƒ—ãƒ­ã‚¤

```bash
# 1. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¯ãƒ­ãƒ¼ãƒ³
cd /var/www
sudo git clone https://github.com/username/prompty.git
cd prompty

# 2. ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
sudo npm ci --production

# 3. ç’°å¢ƒå¤‰æ•°è¨­å®š
sudo nano .env.local
# ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®š

# 4. ãƒ“ãƒ«ãƒ‰
sudo npm run build

# 5. æ‰€æœ‰è€…å¤‰æ›´
sudo chown -R www-data:www-data /var/www/prompty

# 6. PM2ã§èµ·å‹•
sudo pm2 start npm --name "prompty" -- start
sudo pm2 startup
sudo pm2 save
```

### Nginxè¨­å®š

```nginx
# /etc/nginx/sites-available/prompty
server {
    listen 80;
    server_name your-domain.com www.your-domain.com;
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name your-domain.com www.your-domain.com;

    # SSLè¨­å®š
    ssl_certificate /etc/letsencrypt/live/your-domain.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/your-domain.com/privkey.pem;
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384;
    ssl_prefer_server_ciphers off;

    # ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼
    add_header X-Frame-Options "DENY" always;
    add_header X-XSS-Protection "1; mode=block" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header Referrer-Policy "strict-origin-when-cross-origin" always;
    add_header Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https:; style-src 'self' 'unsafe-inline' https:; img-src 'self' data: blob: https:; connect-src 'self' https:;" always;

    # é™çš„ãƒ•ã‚¡ã‚¤ãƒ«
    location /_next/static {
        alias /var/www/prompty/.next/static;
        expires 365d;
        access_log off;
    }

    # ãƒ¡ã‚¤ãƒ³ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }
}
```

### SSLè¨¼æ˜æ›¸è¨­å®š

```bash
# 1. è¨¼æ˜æ›¸å–å¾—
sudo certbot --nginx -d your-domain.com -d www.your-domain.com

# 2. è‡ªå‹•æ›´æ–°è¨­å®š
sudo crontab -e
# ä»¥ä¸‹ã‚’è¿½åŠ 
0 12 * * * /usr/bin/certbot renew --quiet
```

---

## â˜ï¸ AWS ãƒ‡ãƒ—ãƒ­ã‚¤

### AWS Amplifyï¼ˆæ¨å¥¨ï¼‰

```bash
# 1. Amplify CLI ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm install -g @aws-amplify/cli

# 2. åˆæœŸåŒ–
amplify init

# 3. ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°è¿½åŠ 
amplify add hosting

# 4. ãƒ‡ãƒ—ãƒ­ã‚¤
amplify publish
```

### EC2 + RDS + CloudFront

è©³ç´°ãªAWSæ§‹æˆã¯åˆ¥é€”å°‚ç”¨ã‚¬ã‚¤ãƒ‰ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

---

## ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®š

### 1. ç’°å¢ƒå¤‰æ•°ã®ä¿è­·

```bash
# ã‚µãƒ¼ãƒãƒ¼ä¸Šã§ã®ç’°å¢ƒå¤‰æ•°æš—å·åŒ–
sudo apt install gpg

# æš—å·åŒ–
gpg --symmetric --cipher-algo AES256 .env.local

# å¾©å·åŒ–ï¼ˆãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ï¼‰
gpg --decrypt .env.local.gpg > .env.local
```

### 2. ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«è¨­å®š

```bash
# UFWè¨­å®šï¼ˆUbuntuï¼‰
sudo ufw default deny incoming
sudo ufw default allow outgoing
sudo ufw allow ssh
sudo ufw allow 'Nginx Full'
sudo ufw enable
```

### 3. è‡ªå‹•ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ›´æ–°

```bash
# Ubuntu
sudo apt install unattended-upgrades
sudo dpkg-reconfigure -plow unattended-upgrades
```

### 4. ãƒ­ã‚°ç›£è¦–

```bash
# Fail2ban ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
sudo apt install fail2ban

# è¨­å®š
sudo nano /etc/fail2ban/jail.local
```

```ini
# /etc/fail2ban/jail.local
[DEFAULT]
bantime = 10m
findtime = 10m
maxretry = 5

[sshd]
enabled = true

[nginx-http-auth]
enabled = true

[nginx-limit-req]
enabled = true
filter = nginx-limit-req
action = iptables-multiport[name=ReqLimit, port="http,https", protocol=tcp]
logpath = /var/log/nginx/*error.log
findtime = 600
maxretry = 10
```

---

## ğŸ“Š ç›£è¦–ãƒ»ãƒ­ã‚°è¨­å®š

### 1. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ç›£è¦–

```javascript
// lib/monitoring.ts
export const trackError = (error: Error, context?: any) => {
  console.error('Application Error:', error, context);
  
  // Sentry, LogRocketç­‰ã®ã‚µãƒ¼ãƒ“ã‚¹ã¨é€£æº
  if (process.env.NODE_ENV === 'production') {
    // å¤–éƒ¨ç›£è¦–ã‚µãƒ¼ãƒ“ã‚¹ã«é€ä¿¡
  }
};

export const trackPageView = (page: string) => {
  // Google Analyticsç­‰ã¨é€£æº
};
```

### 2. ã‚µãƒ¼ãƒãƒ¼ç›£è¦–

```bash
# ã‚·ã‚¹ãƒ†ãƒ ç›£è¦–ãƒ„ãƒ¼ãƒ«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
sudo apt install htop iotop nethogs

# ãƒ­ã‚°ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š
sudo nano /etc/logrotate.d/prompty
```

```
# /etc/logrotate.d/prompty
/var/log/prompty/*.log {
    daily
    missingok
    rotate 52
    compress
    delaycompress
    notifempty
    create 644 www-data www-data
    postrotate
        pm2 reload prompty
    endscript
}
```

### 3. ã‚¢ãƒ©ãƒ¼ãƒˆè¨­å®š

```bash
# ãƒ‡ã‚£ã‚¹ã‚¯å®¹é‡ç›£è¦–ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
cat > /usr/local/bin/disk-alert.sh << 'EOF'
#!/bin/bash
THRESHOLD=90
USAGE=$(df / | awk 'NR==2 {print $5}' | cut -d'%' -f1)

if [ $USAGE -gt $THRESHOLD ]; then
    echo "ãƒ‡ã‚£ã‚¹ã‚¯ä½¿ç”¨é‡ãŒ${USAGE}%ã«é”ã—ã¾ã—ãŸ" | mail -s "ãƒ‡ã‚£ã‚¹ã‚¯å®¹é‡ã‚¢ãƒ©ãƒ¼ãƒˆ" admin@your-domain.com
fi
EOF

chmod +x /usr/local/bin/disk-alert.sh

# Cronã§å®šæœŸå®Ÿè¡Œ
echo "0 */6 * * * /usr/local/bin/disk-alert.sh" | crontab -
```

---

## ğŸ”„ CI/CD è¨­å®š

### GitHub Actionsï¼ˆæ¨å¥¨ï¼‰

```yaml
# .github/workflows/deploy.yml
name: Deploy to Production

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
        cache: 'npm'
    
    - name: Install dependencies
      run: npm ci
    
    - name: Run tests
      run: npm test
    
    - name: Run linting
      run: npm run lint
    
    - name: Type check
      run: npm run type-check
    
    - name: Build
      run: npm run build

  deploy-staging:
    needs: test
    runs-on: ubuntu-latest
    if: github.event_name == 'pull_request'
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Deploy to Vercel (Preview)
      uses: amondnet/vercel-action@v20
      with:
        vercel-token: ${{ secrets.VERCEL_TOKEN }}
        vercel-org-id: ${{ secrets.ORG_ID }}
        vercel-project-id: ${{ secrets.PROJECT_ID }}

  deploy-production:
    needs: test
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Deploy to Vercel (Production)
      uses: amondnet/vercel-action@v20
      with:
        vercel-token: ${{ secrets.VERCEL_TOKEN }}
        vercel-org-id: ${{ secrets.ORG_ID }}
        vercel-project-id: ${{ secrets.PROJECT_ID }}
        vercel-args: '--prod'
```

### ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆæˆ¦ç•¥

```
feature/new-feature â†’ PR â†’ staging â†’ review â†’ main â†’ production
```

---

## ğŸ“ˆ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### 1. Next.js æœ€é©åŒ–

```javascript
// next.config.js
/** @type {import('next').NextConfig} */
const nextConfig = {
  // æœ¬ç•ªæœ€é©åŒ–
  swcMinify: true,
  compress: true,
  poweredByHeader: false,
  
  // ç”»åƒæœ€é©åŒ–
  images: {
    domains: ['your-cdn-domain.com'],
    formats: ['image/webp', 'image/avif'],
  },
  
  // ãƒãƒ³ãƒ‰ãƒ«åˆ†æ
  webpack: (config, { dev, isServer }) => {
    if (!dev && !isServer) {
      // æœ¬ç•ªãƒ“ãƒ«ãƒ‰ã§ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºæœ€é©åŒ–
      config.optimization.splitChunks.chunks = 'all';
    }
    return config;
  },
  
  // ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼
  async headers() {
    return [
      {
        source: '/(.*)',
        headers: [
          {
            key: 'X-Frame-Options',
            value: 'DENY',
          },
          {
            key: 'X-Content-Type-Options',
            value: 'nosniff',
          },
          {
            key: 'X-XSS-Protection',
            value: '1; mode=block',
          },
        ],
      },
    ];
  },
};

module.exports = nextConfig;
```

### 2. CDNè¨­å®š

```javascript
// lib/cdn.ts
const CDN_BASE_URL = process.env.NEXT_PUBLIC_CDN_URL || '';

export const getCDNUrl = (path: string): string => {
  if (!CDN_BASE_URL) return path;
  return `${CDN_BASE_URL}${path}`;
};

// ä½¿ç”¨ä¾‹
const imageUrl = getCDNUrl('/images/logo.png');
```

### 3. ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥

```nginx
# Nginx ã‚­ãƒ£ãƒƒã‚·ãƒ¥è¨­å®š
location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|webp)$ {
    expires 1y;
    add_header Cache-Control "public, immutable";
    access_log off;
}

location ~* \.(html)$ {
    expires 1h;
    add_header Cache-Control "public";
}
```

---

## â“ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºæ–¹æ³•

#### ğŸ”§ ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼

**ç—‡çŠ¶**: ãƒ“ãƒ«ãƒ‰æ™‚ã«ãƒ¡ãƒ¢ãƒªä¸è¶³ã‚¨ãƒ©ãƒ¼
```
JavaScript heap out of memory
```

**è§£æ±ºæ–¹æ³•**:
```bash
# Node.jsãƒ¡ãƒ¢ãƒªåˆ¶é™ã‚’å¢—åŠ 
export NODE_OPTIONS="--max-old-space-size=4096"
npm run build
```

#### ğŸ” ç’°å¢ƒå¤‰æ•°ãŒèª­ã¿è¾¼ã¾ã‚Œãªã„

**ç—‡çŠ¶**: æœ¬ç•ªç’°å¢ƒã§ç’°å¢ƒå¤‰æ•°ãŒ undefined
```
Error: Missing environment variable
```

**è§£æ±ºæ–¹æ³•**:
```bash
# 1. ç’°å¢ƒå¤‰æ•°åã®ç¢ºèªï¼ˆNEXT_PUBLIC_ ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ï¼‰
echo $NEXT_PUBLIC_SUPABASE_URL

# 2. ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã®è¨­å®šç¢ºèª
# Vercel: Project Settings â†’ Environment Variables
# Netlify: Site settings â†’ Environment variables

# 3. ãƒ“ãƒ«ãƒ‰æ™‚ç’°å¢ƒå¤‰æ•°ã®ç¢ºèª
npm run build 2>&1 | grep -i "environment"
```

#### ğŸŒ CORS ã‚¨ãƒ©ãƒ¼

**ç—‡çŠ¶**: APIå‘¼ã³å‡ºã—æ™‚ã«CORSã‚¨ãƒ©ãƒ¼
```
Access to fetch blocked by CORS policy
```

**è§£æ±ºæ–¹æ³•**:
```javascript
// next.config.js
async headers() {
  return [
    {
      source: "/api/(.*)",
      headers: [
        { key: "Access-Control-Allow-Origin", value: "https://your-domain.com" },
        { key: "Access-Control-Allow-Methods", value: "GET,OPTIONS,PATCH,DELETE,POST,PUT" },
        { key: "Access-Control-Allow-Headers", value: "X-CSRF-Token, X-Requested-With, Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, X-Api-Version, Authorization" },
      ],
    },
  ];
}
```

#### ğŸ“Š ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã‚¨ãƒ©ãƒ¼

**ç—‡çŠ¶**: Supabaseæ¥ç¶šã‚¨ãƒ©ãƒ¼
```
Database connection failed
```

**è§£æ±ºæ–¹æ³•**:
```bash
# 1. æ¥ç¶šæƒ…å ±ç¢ºèª
curl -I $NEXT_PUBLIC_SUPABASE_URL

# 2. APIã‚­ãƒ¼ç¢ºèª
# Supabase Dashboard â†’ Settings â†’ API

# 3. ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç¢ºèª
ping your-project.supabase.co

# 4. RLSãƒãƒªã‚·ãƒ¼ç¢ºèª
# Supabase Dashboard â†’ Authentication â†’ Policies
```

#### ğŸ’³ æ±ºæ¸ˆã‚¨ãƒ©ãƒ¼

**ç—‡çŠ¶**: Stripeæ±ºæ¸ˆãŒå‹•ä½œã—ãªã„
```
Payment processing failed
```

**è§£æ±ºæ–¹æ³•**:
```bash
# 1. APIã‚­ãƒ¼ç¢ºèªï¼ˆæœ¬ç•ª vs ãƒ†ã‚¹ãƒˆï¼‰
echo $STRIPE_SECRET_KEY | grep -o '^sk_[a-z]*'
# sk_live_... (æœ¬ç•ª) ã¾ãŸã¯ sk_test_... (ãƒ†ã‚¹ãƒˆ)

# 2. Webhookã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆç¢ºèª
curl -X POST https://your-domain.com/api/stripe/webhook \
  -H "Content-Type: application/json" \
  -d '{"test": true}'

# 3. Stripe Dashboardç¢ºèª
# https://dashboard.stripe.com/webhooks
```

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å•é¡Œ

#### ğŸ“ˆ èª­ã¿è¾¼ã¿é€Ÿåº¦æ”¹å–„

```bash
# 1. ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºåˆ†æ
npm install --save-dev @next/bundle-analyzer

# next.config.js ã«è¿½åŠ 
const withBundleAnalyzer = require('@next/bundle-analyzer')({
  enabled: process.env.ANALYZE === 'true',
});

# å®Ÿè¡Œ
ANALYZE=true npm run build

# 2. Lighthouseç›£æŸ»
npm install -g lighthouse
lighthouse https://your-domain.com --output html --output-path report.html
```

#### ğŸ” ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯èª¿æŸ»

```bash
# Node.js ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ç›£è¦–
node --inspect --inspect-port=9229 server.js

# Chrome DevTools ã§ chrome://inspect ã‹ã‚‰ãƒ‡ãƒãƒƒã‚°
```

### ãƒ­ã‚°åˆ†æ

#### ğŸ“‹ ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°åé›†

```bash
# PM2 ãƒ­ã‚°
pm2 logs prompty --lines 100

# Nginx ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°
sudo tail -f /var/log/nginx/error.log

# ã‚·ã‚¹ãƒ†ãƒ ãƒ­ã‚°
sudo journalctl -u nginx -f
```

#### ğŸ“Š ã‚¢ã‚¯ã‚»ã‚¹è§£æ

```bash
# Nginx ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°è§£æ
sudo cat /var/log/nginx/access.log | awk '{print $1}' | sort | uniq -c | sort -nr | head -10

# ã‚¨ãƒ©ãƒ¼ç‡è¨ˆç®—
sudo grep -c "HTTP/1.1\" [45]" /var/log/nginx/access.log
```

---

## ğŸ¯ æœ¬ç•ªé‹ç”¨ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### ãƒ‡ãƒ—ãƒ­ã‚¤å‰ãƒã‚§ãƒƒã‚¯

- [ ] ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆãŒé€šéã—ã¦ã„ã‚‹
- [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ»ã‚’å®Ÿæ–½æ¸ˆã¿
- [ ] æœ¬ç•ªç”¨ç’°å¢ƒå¤‰æ•°ãŒè¨­å®šæ¸ˆã¿
- [ ] SSLè¨¼æ˜æ›¸ãŒæœ‰åŠ¹
- [ ] ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä½“åˆ¶ãŒæ•´ã£ã¦ã„ã‚‹
- [ ] ç›£è¦–ãƒ»ã‚¢ãƒ©ãƒ¼ãƒˆè¨­å®šãŒå®Œäº†
- [ ] ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒæœ€æ–°

### ãƒ‡ãƒ—ãƒ­ã‚¤å¾Œãƒã‚§ãƒƒã‚¯

- [ ] å…¨ãƒšãƒ¼ã‚¸ãŒæ­£å¸¸ã«è¡¨ç¤ºã•ã‚Œã‚‹
- [ ] ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ãŒå‹•ä½œã™ã‚‹
- [ ] æ±ºæ¸ˆæ©Ÿèƒ½ãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹
- [ ] APIå¿œç­”é€Ÿåº¦ãŒæ­£å¸¸ç¯„å›²å†…
- [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹
- [ ] ãƒ­ã‚°å‡ºåŠ›ãŒæ­£å¸¸
- [ ] ç›£è¦–ã‚¢ãƒ©ãƒ¼ãƒˆãŒå‹•ä½œã™ã‚‹

### å®šæœŸãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹

- [ ] é€±æ¬¡: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ›´æ–°ç¢ºèª
- [ ] æœˆæ¬¡: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åˆ†æ
- [ ] å››åŠæœŸ: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ»
- [ ] å¹´æ¬¡: ç½å®³å¾©æ—§ãƒ†ã‚¹ãƒˆ

---

## ğŸ“ ã‚µãƒãƒ¼ãƒˆãƒ»ãƒªã‚½ãƒ¼ã‚¹

### å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- [Next.js Deployment](https://nextjs.org/docs/deployment)
- [Vercel Documentation](https://vercel.com/docs)
- [Supabase Production Checklist](https://supabase.com/docs/guides/platform/going-into-prod)

### ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£
- [Next.js Discord](https://discord.gg/nextjs)
- [Supabase Discord](https://discord.supabase.com/)
- [Vercel Community](https://github.com/vercel/vercel/discussions)

### ç·Šæ€¥æ™‚é€£çµ¡å…ˆ
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å•é¡Œ: security@prompty.com
- ã‚·ã‚¹ãƒ†ãƒ éšœå®³: ops@prompty.com

---

*æœ€çµ‚æ›´æ–°: 2024å¹´6æœˆ7æ—¥*
*ãƒãƒ¼ã‚¸ãƒ§ãƒ³: 1.0.0*

ğŸš€ **æœ¬ç•ªç’°å¢ƒã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤æº–å‚™å®Œäº†ï¼å®‰å…¨ã§é«˜æ€§èƒ½ãªã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«æä¾›ã—ã¾ã—ã‚‡ã†ã€‚**